# Аналитика и расчет заказа для аптек. 
## Цель разработки проекта
Расчет потребности для оптимальной закупки товара. Сократить время анализа товарного запаса с нескольких часов до нескольких минут. Сформировать  потребность с учетом времени доставки, приоритета приносимой прибыли, излишних остатков товара в аптечной сети, товара на центральном складе. Оптимальное использование обороных средств предприятия.

## Общие сведения

В этом конкретном случае нам нет необходимости использовать инструменты типа Airbyte. Аналитическая база находится на том же сервере, что и основная в одном и том же инстансе. Размер базы пока менее 1Gb.
MS SQL Server позволяет выполнять запросы к другой базу в контексте основной. Для получения сырых данных сформированы представления :

* Чеки
* Содержимое чеков
* Список поставщиков и аптек (в основной системе они хранятся в одной таблице)
* Наименования для анализа и наименования для свертки аналогичных товаров
* Список приходных накладных 
* Содержимое приходных накладных
* Перемещения товаров между аптеками
* Остатки товаров в аптеках
* Единицы измерения: в учетной системе все количества только в целых числах напрмер 1 упаковка, 1 блистер (1/3 упаковки). Там же выполняется расчет коэффициента пересчета в базовые единицы измерения 
* Список отделов в аптеках: один и тот же товар может быть в нескольких отделах

## Порядок расчетов

* Формируем список складов в привязке к аптекам
* Сворачиваем остатки товаров по аптекам 
* Формируем таблицу розничных продаж
* Формируем таблицу прихода товаров: документы прихода могут быть как полностью сформированы, так и быть "в работе"
* По списку товаров из незаконченных документов формируем товары "в пути". Они не влияют на остаток, но необходимо учитывать при заказе, что товар скоро появится
* По статистике продаж делим товары в каждой аптеке на группы А, А1, B, C, C1
* Формируем таблицу со статистикой продаж: сколько в среднем в день продается товар за период анализа, товарный остаток в днях, количество товаров в пути до аптеки 
* Расчитываем количество сверхзапаса в аптеках. Если товарный запас более месяца, то аптека может переместить его на другие точки.
* Производим расчет потребности товара в соответствии с группой: группа А - дает максимальную прибыль, группа С1 - сопутствующие товары. Группу С1 заказываем, только если остаток нулевой. Добавляем данные о сверхзапас в сети, количество товара на центральном складе.

![Lineage Graph](dbt-dag.png)
![Lineage Graph](result.png)
## Планы по доработке системы

* Разработка приложения для выгрузки потребности систему сводных прайс листов. Будет использованна часть старой разработки 
![Lineage Graph](zakaz1.png)
![Lineage Graph](zakaz2.png)
* Подключение машинного обучения ML (готовые библиотеки, например Etna от Tinkoff )
* Загрузка дополнительных данных для обогащения: интернет заказы, календари с рабочими/нерабочими днями,календари с типом погоды (такая градация есть в Камчатском крае, в других регионах не встречал), статистика "от заказа до прилавка", данные об оплатах и задолженности предприятия
* Настройка CI/CD

## 
Welcome to your new dbt project!

### Using the starter project

Try running the following commands:
- dbt run
- dbt test


### Resources:
- Learn more about dbt [in the docs](https://docs.getdbt.com/docs/introduction)
- Check out [Discourse](https://discourse.getdbt.com/) for commonly asked questions and answers
- Join the [chat](http://slack.getdbt.com/) on Slack for live discussions and support
- Find [dbt events](https://events.getdbt.com) near you
- Check out [the blog](https://blog.getdbt.com/) for the latest news on dbt's development and best practices
